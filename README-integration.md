# 智能小车控制系统 - Tauri版本

## 项目概述

这是一个基于Tauri + React + Rust的智能小车控制系统，整合了原有的car_expo项目功能，通过USB-CAN转换器硬件替代了FreeMaster通信方式。

## 功能特点

### 🚗 车辆控制Tab
- **连接管理**: 串口连接配置和状态监控
- **车门控制**: 左车门开启/关闭/停止操作
- **风扇控制**: 3档风扇速度控制（档位0-2）
- **灯带控制**: 4种灯带闪烁模式
- **状态显示**: 实时显示各系统状态
- **主要控制**: 开始行驶、数据更新等功能

### ⚙️ CAN配置Tab
- **串口配置**: 波特率、CAN波特率、帧类型、CAN模式设置
- **消息发送**: 手动发送CAN消息（ID + 数据）
- **消息接收**: 实时接收和显示CAN消息
- **命令配置**: 可视化配置车辆控制命令的CAN ID和数据
- **消息记录**: 完整的发送/接收消息历史

## 技术架构

### 前端 (React + TypeScript)
- **UI框架**: React 18 + TypeScript
- **样式**: Tailwind CSS
- **图标**: Lucide React
- **构建工具**: Vite

### 后端 (Rust)
- **框架**: Tauri 2.x
- **串口通信**: serialport crate
- **异步运行时**: Tokio
- **错误处理**: anyhow

### 通信协议
- **USB-CAN协议**: 替代原FreeMaster协议
- **包格式**: `[0xAA, 0x55, command, data..., checksum]`
- **支持帧类型**: 标准帧(11位ID) / 扩展帧(29位ID)
- **CAN模式**: 正常/回环/监听模式

## 项目结构

```
usb-can-tauri/
├── src/                    # React前端代码
│   ├── App.tsx            # 主应用组件（整合版本）
│   ├── App-original.tsx   # 原始CAN控制台
│   └── main.tsx           # 应用入口
├── src-tauri/             # Rust后端代码
│   ├── src/lib.rs         # 主要业务逻辑
│   └── Cargo.toml         # Rust依赖配置
├── public/
│   └── car-assets/        # car_expo静态资源
│       ├── css/           # 样式文件
│       ├── js/            # JavaScript库
│       ├── images/        # 图片资源
│       ├── models/        # 3D模型文件
│       └── videos/        # 视频文件
└── README-integration.md  # 本文档
```

## CAN命令配置

系统预配置了以下车辆控制命令：

| 功能 | CAN ID | 数据 | 描述 |
|------|--------|------|------|
| 左门开启 | 123 | 02 | 打开左车门 |
| 左门关闭 | 123 | 01 | 关闭左车门 |
| 左门停止 | 123 | 00 | 停止左车门 |
| 风扇档位0 | 124 | 00 | 风扇关闭 |
| 风扇档位1 | 124 | 01 | 风扇低速 |
| 风扇档位2 | 124 | 02 | 风扇高速 |
| 灯带模式1 | 125 | 00 | 灯带模式1 |
| 灯带模式2 | 125 | 01 | 灯带模式2 |
| 灯带模式3 | 125 | 02 | 灯带模式3 |
| 灯带模式4 | 125 | 03 | 灯带模式4 |

*注：所有CAN ID和数据值都可以在"CAN配置"Tab中实时修改*

## 使用方法

### 开发模式
```bash
cd usb-can-tauri
npm run tauri dev
```

### 构建发布版
```bash
npm run tauri build
```

### 生成的文件
- **macOS**: `.app` 应用包 + `.dmg` 安装包
- **Windows**: `.exe` 安装程序
- **Linux**: `.AppImage` 可执行文件

## 主要改进

### 相比原car_expo项目
1. ✅ **移除FreeMaster依赖** - 使用USB-CAN硬件通信
2. ✅ **现代化架构** - Tauri + React + Rust技术栈
3. ✅ **跨平台支持** - Windows、macOS、Linux、Android
4. ✅ **实时配置** - 可视化CAN命令配置界面
5. ✅ **消息监控** - 完整的CAN消息收发记录
6. ✅ **原生性能** - Rust后端提供高性能串口通信

### 相比原usb-can-tauri项目
1. ✅ **车辆控制界面** - 整合car_expo的控制面板
2. ✅ **双Tab设计** - 车辆控制 + CAN配置分离
3. ✅ **预配置命令** - 内置车辆控制命令映射
4. ✅ **状态反馈** - 实时显示车辆各系统状态
5. ✅ **用户友好** - 简化的车辆操作界面

## 开发说明

### 添加新的车辆控制命令
1. 在`canCommands`数组中添加新命令配置
2. 在`updateCarState`函数中添加状态更新逻辑
3. 在CarControlTab组件中添加对应的UI控件

### 修改CAN协议
1. 更新`src-tauri/src/lib.rs`中的协议实现
2. 修改包格式和校验和计算逻辑
3. 更新前端的数据格式验证

## 注意事项

1. **串口权限**: 在Linux/macOS上可能需要串口访问权限
2. **硬件兼容**: 确保USB-CAN转换器支持所配置的波特率
3. **CAN ID冲突**: 避免不同功能使用相同的CAN ID
4. **数据格式**: CAN数据最大8字节，使用十六进制格式

## 故障排除

### 连接问题
- 检查串口设备是否正确识别
- 确认波特率配置匹配硬件设置
- 验证USB-CAN转换器驱动程序

### 消息发送失败
- 检查CAN ID格式（十六进制）
- 确认数据长度不超过8字节
- 验证CAN总线连接状态

### 界面显示问题
- 确保Tailwind CSS正确加载
- 检查浏览器控制台错误信息
- 验证React组件状态更新

## 未来扩展

1. **3D模型集成** - 将car_expo的3D车辆模型集成到Tauri应用
2. **视频播放** - 添加车辆演示视频播放功能
3. **数据记录** - 实现CAN消息的本地存储和回放
4. **脚本支持** - 添加自动化测试脚本功能
5. **多设备支持** - 同时连接多个USB-CAN转换器

---

**项目状态**: ✅ 基础整合完成，可正常使用车辆控制和CAN配置功能
