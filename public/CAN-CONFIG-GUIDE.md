# CAN配置使用指南

## 🎯 配置模式

### 📡 普通模式 (默认)
- **用途**: 单个USB-CAN设备与外部CAN网络通信
- **串口配置**: 只需配置一个串口
- **适用场景**: 连接真实的CAN设备或网络

### 🔄 回环测试模式
- **用途**: 使用两个USB-CAN设备进行内部测试
- **串口配置**: 需要配置两个串口（发送端口和接收端口）
- **适用场景**: 验证CAN通信功能，无需外部CAN设备

## ⚙️ 配置参数说明

### 串口设置
- **串口**: USB-CAN设备的COM端口号（如：COM22）
- **串口波特率**: 电脑与USB-CAN设备之间的通信速度
  - 推荐值：`2000000` (2M)
  - 作用：控制USB串口数据传输速度

### CAN设置
- **CAN波特率**: CAN总线上的通信速度
  - 推荐值：`2000000` (2M) 或 `500000` (500K)
  - 作用：控制CAN网络中设备间的通信速度
- **帧类型**: 
  - 标准帧：11位ID
  - 扩展帧：29位ID（推荐）
- **CAN模式**:
  - 正常模式：标准CAN通信
  - 回环模式：内部回环测试
  - 监听模式：只接收，不发送

## 🔧 回环测试配置示例

### 硬件连接
```
电脑 USB → USB-CAN设备1 (COM22) → CAN总线
电脑 USB → USB-CAN设备2 (COM23) → CAN总线
```

### 软件配置
1. ✅ 勾选"启用双串口回环测试模式"
2. 🔧 发送端口：`COM22`
3. 🔧 接收端口：`COM23`
4. ⚡ 串口波特率：`2000000`
5. 📡 CAN波特率：`2000000`
6. 📋 帧类型：扩展帧
7. 🎯 CAN模式：正常模式

### 测试数据
- **CAN ID**: `01234567` (8位十六进制)
- **数据**: `11 22 33 44 55 66 77 88` (最多8字节，空格分隔)

## 🚀 使用步骤

### 普通模式
1. 确保回环测试模式**未勾选**
2. 输入串口号（如：COM22）
3. 设置波特率
4. 点击"连接"
5. 发送/接收CAN消息

### 回环测试模式
1. ✅ 勾选"启用双串口回环测试模式"
2. 输入两个串口号
3. 设置波特率
4. 输入测试数据
5. 点击"执行回环测试"
6. 查看测试结果

## 🐛 常见问题

### 连接失败
- 检查COM端口是否正确
- 确认设备未被其他程序占用
- 验证USB-CAN设备是否正常工作

### 回环测试失败
- 确认两个COM端口都存在
- 检查CAN总线连接
- 验证波特率设置是否一致
- 确保两个设备连接到同一CAN网络

### 数据格式错误
- CAN ID：1-8位十六进制数字
- 数据：十六进制字节，空格分隔，最多8字节
- 示例：`01 02 03 04` 或 `AA BB CC DD EE FF`

## 💡 最佳实践

1. **波特率选择**: 优先使用2M波特率以获得最佳性能
2. **帧类型**: 推荐使用扩展帧，兼容性更好
3. **测试流程**: 先用回环测试验证功能，再连接实际设备
4. **错误处理**: 遇到问题时查看浏览器控制台的详细错误信息

## 📚 技术参考

- USB-CAN协议基于变长数据包格式
- 支持标准帧(11位ID)和扩展帧(29位ID)
- 最大数据长度：8字节
- 支持的CAN波特率：5K - 2M
- 支持的串口波特率：9600 - 2M
