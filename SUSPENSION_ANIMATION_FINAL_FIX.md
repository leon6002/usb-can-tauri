# 悬挂动画最终修复

## 问题

升高悬挂时，车身升高了，但轮子也跟着车一起升高了。

## 根本原因

轮子是车身的子对象（通过悬挂 Group 连接），所以当车身移动时，轮子也会跟着移动。

## 解决方案

**同时改变车身和悬挂的位置，但方向相反**：

- **升高悬挂**：
  - 悬挂向下压缩（Y -= 0.3m）
  - 车身向上升（Y += 0.3m）
  - 结果：轮子保持在地面上，车身向上升

- **降低悬挂**：
  - 悬挂向上伸展（Y += 0.3m）
  - 车身向下降（Y -= 0.3m）
  - 结果：轮子保持在地面上，车身向下降

## 实现细节

### 1. 保存初始位置

在 `startSuspensionUp()` 和 `startSuspensionDown()` 中保存：
- 车身的初始位置
- 所有悬挂的初始位置

### 2. 动画更新逻辑

```typescript
// 计算位移
const displacement = direction * maxHeight * easeProgress;

// 改变车身位置（反向）
carBody.position.y -= displacement;

// 改变悬挂位置（正向）
suspension.position.y += displacement;
```

### 3. 方向设置

**升高**：`direction = -1`
- 悬挂位移：-1 * 0.3 = -0.3（向下）
- 车身位移：-(-0.3) = +0.3（向上）

**降低**：`direction = 1`
- 悬挂位移：1 * 0.3 = +0.3（向上）
- 车身位移：-(+0.3) = -0.3（向下）

## 修改的文件

### src/components/Car3D/AnimationController.ts

1. 恢复 `suspensions` 属性
2. 修改构造函数接收悬挂对象
3. 修改 `startSuspensionUp()` 保存车身和悬挂位置
4. 修改 `startSuspensionDown()` 保存车身和悬挂位置
5. 修改 `updateSuspensionAnimation()` 同时改变车身和悬挂位置

### src/components/Car3D/Car3DRenderer.ts

- 恢复传递悬挂对象到 AnimationController

## 参数配置

- 动画持续时间：1000ms（1秒）
- 最大升降距离：0.3m（30cm）
- 缓动函数：InOutQuad（平滑加速/减速）

## 编译状态

✅ TypeScript 编译成功
✅ Vite 构建成功
✅ 所有代码已构建完成

## 测试结果

- ✅ 升高悬挂：车身向上升，轮子保持在地面
- ✅ 降低悬挂：车身向下降，轮子保持在地面
- ✅ 转向功能：不受悬挂动画影响
- ✅ 动画平滑：使用 InOutQuad 缓动函数

## 关键要点

1. **反向移动** - 车身和悬挂方向相反
2. **轮子保持在地面** - 通过反向移动实现
3. **同时更新** - 每帧同时改变车身和悬挂位置
4. **保存初始位置** - 确保动画可以重复执行

## 工作原理

```
升高悬挂时：
  悬挂向下 (-0.3m)
  轮子随悬挂向下 (-0.3m)
  但轮子应该保持在地面上
  所以车身向上 (+0.3m)
  结果：轮子相对地面不动，车身向上升

降低悬挂时：
  悬挂向上 (+0.3m)
  轮子随悬挂向上 (+0.3m)
  但轮子应该保持在地面上
  所以车身向下 (-0.3m)
  结果：轮子相对地面不动，车身向下降
```

